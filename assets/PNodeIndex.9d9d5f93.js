import{cr as q,a5 as J,d as z,u as K,k as M,l as Q,m as P,n as X,cs as Y,bk as T,bT as Z,h as F,J as h,p as b,bB as ee,F as S,S as te,x as ue,A as V,U as ae,C as n,z as p,c6 as A,bd as ne,B as u,D as B,y as U,ba as $,bc as le,r as y,cc as oe,_ as se,cd as ie,H as j,c1 as re,aq as de,q as me,c7 as pe,ce as L,W as ce,c8 as _e,be as ve,c2 as fe,ca as ge}from"./index.1cac1bad.js";import{_ as G}from"./PLink.vue_vue_type_script_setup_true_lang.f43831db.js";import{g as ye,b as W,c as Fe,_ as be}from"./Time.9bd2104a.js";import{N}from"./text.0b3e9adc.js";import{_ as Be}from"./PSelector.vue_vue_type_script_setup_true_lang.72ee34c2.js";import{_ as Ee}from"./PSwitch.vue_vue_type_script_setup_true_lang.7eba46de.js";import{_ as ke,a as Ce}from"./InputNumber.3af073ba.js";import{_ as xe}from"./DrawerContent.46b0fda8.js";const he=()=>q,De={name:"Space",self:he},we=De;let R;const $e=()=>{if(!J)return!0;if(R===void 0){const l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.rowGap="1px",l.appendChild(document.createElement("div")),l.appendChild(document.createElement("div")),document.body.appendChild(l);const d=l.scrollHeight===1;return document.body.removeChild(l),R=d}return R},Ae=Object.assign(Object.assign({},M.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,size:{type:[String,Number,Array],default:"medium"},wrapItem:{type:Boolean,default:!0},itemStyle:[String,Object],wrap:{type:Boolean,default:!0},internalUseGap:{type:Boolean,default:void 0}}),Se=z({name:"Space",props:Ae,setup(l){const{mergedClsPrefixRef:d,mergedRtlRef:a}=K(l),m=M("Space","-space",void 0,we,l,d),c=Q("Space",a,d);return{useGap:$e(),rtlEnabled:c,mergedClsPrefix:d,margin:P(()=>{const{size:e}=l;if(Array.isArray(e))return{horizontal:e[0],vertical:e[1]};if(typeof e=="number")return{horizontal:e,vertical:e};const{self:{[X("gap",e)]:_}}=m.value,{row:s,col:E}=Y(_);return{horizontal:T(E),vertical:T(s)}})}},render(){const{vertical:l,align:d,inline:a,justify:m,itemStyle:c,margin:e,wrap:_,mergedClsPrefix:s,rtlEnabled:E,useGap:r,wrapItem:D,internalUseGap:v}=this,t=Z(ye(this));if(!t.length)return null;const k=`${e.horizontal}px`,i=`${e.horizontal/2}px`,C=`${e.vertical}px`,g=`${e.vertical/2}px`,x=t.length-1,w=m.startsWith("space-");return F("div",{role:"none",class:[`${s}-space`,E&&`${s}-space--rtl`],style:{display:a?"inline-flex":"flex",flexDirection:l?"column":"row",justifyContent:["start","end"].includes(m)?"flex-"+m:m,flexWrap:!_||l?"nowrap":"wrap",marginTop:r||l?"":`-${g}`,marginBottom:r||l?"":`-${g}`,alignItems:d,gap:r?`${e.vertical}px ${e.horizontal}px`:""}},!D&&(r||v)?t:t.map((I,f)=>F("div",{role:"none",style:[c,{maxWidth:"100%"},r?"":l?{marginBottom:f!==x?C:""}:E?{marginLeft:w?m==="space-between"&&f===x?"":i:f!==x?k:"",marginRight:w?m==="space-between"&&f===0?"":i:"",paddingTop:g,paddingBottom:g}:{marginRight:w?m==="space-between"&&f===x?"":i:f!==x?k:"",marginLeft:w?m==="space-between"&&f===0?"":i:"",paddingTop:g,paddingBottom:g}]},I)))}}),Ue=z({__name:"PNodeList",props:["data"],setup(l){const d=[{title:"ID",key:"id",render(a){return F(ee,{},()=>a.id)}},{title:"\u8282\u70B9\u540D\u79F0",key:"name"},{title:"\u5E73\u53F0",key:"os"},{title:"\u8282\u70B9\u7EC4",key:"group",render(a){return F(N,{},()=>F(G,{to:{name:"admin.node.group",params:{groupId:a.group.id}}},()=>a.group.name))}},{title:"\u5DF2\u5206\u914D\u5185\u5B58 / \u603B\u91CF",key:"memory",render(a){return F(N,{},()=>S(a.instances_sum_memory*1024*1024)+" / "+S(a.memory*(1+a.memory_overallocate/100)*1024*1024)+" ("+(a.instances_sum_memory/(a.memory*(1+a.memory_overallocate/100))*100).toFixed(1)+"%)")}},{title:"\u5DF2\u5206\u914D\u786C\u76D8 / \u603B\u91CF",key:"disk",render(a){return F(N,{},()=>S(a.instances_sum_disk*1024*1024)+" / "+S(a.disk*(1+a.disk_overallocate/100)*1024*1024)+" ("+(a.instances_sum_disk/(a.disk*(1+a.disk_overallocate/100))*100).toFixed(1)+"%)")}},{title:"\u5B9E\u4F8B\u6570\u91CF",key:"instances_count"},{title:"\u4FEE\u6539\u65F6\u95F4",key:"updated_at",render(a){return F(W,{time:new Date(a.updated_at)})}},{title:"\u64CD\u4F5C",key:"action",render(a){return F(G,{to:{name:"admin.node.index",params:{nodeId:a.id}},element:"button",size:"small","text-color":"white"},()=>"\u4FEE\u6539")}}];return(a,m)=>{const c=Fe;return b(),h(c,{class:"table",columns:d,data:l.data,bordered:!0},null,8,["data"])}}});const ze=te(Ue,[["__scopeId","data-v-79b3ce15"]]),Ie={class:"mt-1.5"},Ne={class:"mt-1.5"},Re=z({__name:"PNodeEditor",props:["id"],emits:["update:id","reload"],setup(l,{emit:d}){const a=l,m=ue(),c={id:0,name:"",description:"",node_group_id:"",endpoint:"",enable_tls:0,node_token:"",panel_token:"",os:"",memory:0,memory_overallocate:0,disk:0,disk_overallocate:0,created_at:0,updated_at:0},e=V(c),_=V(),s={init(){e.value=c,s.load()},load(){A.node.group.list().then(v=>{_.value=v.data.data.map(t=>({label:t.id+"-"+t.name,value:t.id}))}),!r.value&&A.node.detail(a.id).then(v=>{e.value=v.data.attributes})},confirm(){r.value?A.node.create(e.value).then(()=>{s.close("\u8282\u70B9\u521B\u5EFA\u6210\u529F\u3002",!0)}):A.node.update(a.id,e.value).then(()=>{s.close("\u8282\u70B9\u4FEE\u6539\u6210\u529F\u3002",!0)})},delete(){A.node.delete(a.id).then(()=>{s.close("\u8282\u70B9\u5220\u9664\u6210\u529F\u3002",!0)})},close(v,t){v&&m.success(v),t&&d("reload"),d("update:id",null)}},E=window.innerWidth,r=P(()=>a.id=="create");ae(()=>a.id,v=>!v||s.init());const D=window.location.origin;return(v,t)=>{const k=ke,i=Ce,C=se,g=be,x=Se,w=W,I=ie,f=j,H=xe,O=ne;return b(),h(O,{"default-width":Math.min(768,p(E)),resizable:"",placement:"right","mask-closable":!1,show:!!l.id,"onUpdate:show":s.close},{default:n(()=>[u(H,{closable:"","native-scrollbar":!1},{header:n(()=>[B(U(p(r)?"\u521B\u5EFA\u8282\u70B9":"\u4FEE\u6539\u8282\u70B9"),1)]),footer:n(()=>[p(r)?$("",!0):(b(),h(f,{key:0,type:"error",ghost:"",onClick:t[13]||(t[13]=o=>s.delete())},{default:n(()=>[B("\u5220\u9664")]),_:1})),u(f,{type:"primary","text-color":"white",onClick:t[14]||(t[14]=o=>s.confirm())},{default:n(()=>[B(U(p(r)?"\u521B\u5EFA":"\u4FEE\u6539"),1)]),_:1})]),default:n(()=>[u(I,{model:e.value,"label-placement":"left","label-width":84,class:"mt-2",onSubmit:t[12]||(t[12]=le(o=>s.confirm(),["prevent"]))},{default:n(()=>[p(r)?$("",!0):(b(),h(i,{key:0,label:"ID"},{default:n(()=>[u(k,{value:e.value.id,"onUpdate:value":t[0]||(t[0]=o=>e.value.id=o),readonly:""},null,8,["value"])]),_:1})),u(i,{label:"\u540D\u79F0"},{default:n(()=>[u(C,{value:e.value.name,"onUpdate:value":t[1]||(t[1]=o=>e.value.name=o),placeholder:"\u8F93\u5165\u8282\u70B9\u540D\u79F0"},null,8,["value"])]),_:1}),u(i,{label:"\u8282\u70B9\u7B80\u4ECB"},{default:n(()=>[u(C,{value:e.value.description,"onUpdate:value":t[2]||(t[2]=o=>e.value.description=o),placeholder:"\u8F93\u5165\u8282\u70B9\u7B80\u4ECB",type:"textarea"},null,8,["value"])]),_:1}),u(i,{label:"\u6240\u5C5E\u8282\u70B9\u7EC4"},{default:n(()=>[u(Be,{list:_.value,modelValue:e.value.node_group_id,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.node_group_id=o)},null,8,["list","modelValue"])]),_:1}),u(i,{label:"\u8FDE\u63A5\u5730\u5740"},{default:n(()=>[u(C,{value:e.value.endpoint,"onUpdate:value":t[4]||(t[4]=o=>e.value.endpoint=o),placeholder:"\u8F93\u5165 IP:\u7AEF\u53E3 / \u57DF\u540D:\u7AEF\u53E3"},null,8,["value"])]),_:1}),u(i,{label:"\u542F\u7528 TLS"},{default:n(()=>[u(Ee,{modelValue:e.value.enable_tls,"onUpdate:modelValue":t[5]||(t[5]=o=>e.value.enable_tls=o),element:"switch"},null,8,["modelValue"])]),_:1}),p(r)?$("",!0):(b(),h(i,{key:1,label:"\u9762\u677F\u5BC6\u94A5"},{default:n(()=>[u(C,{value:e.value.panel_token,readonly:""},null,8,["value"])]),_:1})),p(r)?$("",!0):(b(),h(i,{key:2,label:"\u8282\u70B9\u5BC6\u94A5"},{default:n(()=>[u(C,{value:e.value.node_token,readonly:""},null,8,["value"])]),_:1})),u(i,{label:"\u64CD\u4F5C\u7CFB\u7EDF"},{default:n(()=>[u(g,{checked:e.value.os==="linux",onChange:t[6]||(t[6]=o=>e.value.os="linux")},{default:n(()=>[B("Linux")]),_:1},8,["checked"]),u(g,{checked:e.value.os==="windows",onChange:t[7]||(t[7]=o=>e.value.os="windows")},{default:n(()=>[B("Windows")]),_:1},8,["checked"])]),_:1}),u(i,{label:"\u5185\u5B58\u9650\u5236"},{default:n(()=>[y("div",null,[u(x,null,{default:n(()=>[u(k,{value:e.value.memory,"onUpdate:value":t[8]||(t[8]=o=>e.value.memory=o),min:"0",placeholder:"\u8F93\u5165\u5185\u5B58\u9650\u5236"},null,8,["value"]),u(k,{value:e.value.memory_overallocate,"onUpdate:value":t[9]||(t[9]=o=>e.value.memory_overallocate=o),min:"0",placeholder:"\u8F93\u5165\u8D85\u552E\u767E\u5206\u6BD4 0\u4E3A\u4E0D\u542F\u7528"},null,8,["value"])]),_:1}),y("div",Ie,[y("i",null,[B("\u6700\u7EC8\u5185\u5B58\u53EF\u5206\u914D\u5927\u5C0F\uFF1A"),y("b",null,U(p(S)(e.value.memory*(e.value.memory_overallocate/100+1)*1024*1024)),1)])])])]),_:1}),u(i,{label:"\u786C\u76D8\u9650\u5236"},{default:n(()=>[y("div",null,[u(x,null,{default:n(()=>[u(k,{step:1024,value:e.value.disk,"onUpdate:value":t[10]||(t[10]=o=>e.value.disk=o),min:"0",placeholder:"\u8F93\u5165\u786C\u76D8\u9650\u5236"},null,8,["value"]),u(k,{value:e.value.disk_overallocate,"onUpdate:value":t[11]||(t[11]=o=>e.value.disk_overallocate=o),min:"0",placeholder:"\u8F93\u5165\u8D85\u552E\u767E\u5206\u6BD4 0\u4E3A\u4E0D\u542F\u7528"},null,8,["value"])]),_:1}),y("div",Ne,[y("i",null,[B("\u6700\u7EC8\u786C\u76D8\u53EF\u5206\u914D\u5927\u5C0F\uFF1A"),y("b",null,U(p(S)(e.value.disk*(e.value.disk_overallocate/100+1)*1024*1024)),1)])])])]),_:1}),p(r)?$("",!0):(b(),h(i,{key:3,label:"\u66F4\u65B0\u65F6\u95F4"},{default:n(()=>[u(w,{time:new Date(e.value.updated_at)},null,8,["time"])]),_:1})),p(r)?$("",!0):(b(),h(i,{key:4,label:"\u521B\u5EFA\u65F6\u95F4",class:"-mt-4"},{default:n(()=>[u(w,{time:new Date(e.value.created_at)},null,8,["time"])]),_:1})),u(i,{label:"\u90E8\u7F72\u547D\u4EE4"},{default:n(()=>[u(C,{value:"./node "+p(D)+" "+e.value.panel_token,type:"textarea",autosize:"",readonly:""},null,8,["value"])]),_:1}),u(oe)]),_:1},8,["model"])]),_:1})]),_:1},8,["default-width","show","onUpdate:show"])}}}),Ve={class:"mdui-container mt-4"},Oe=z({__name:"PNodeIndex",setup(l){const d=V([]),a=()=>A.node.list().then(_=>{d.value=_.data.data}),m=ve(),c=fe();let e;return re().listen(()=>{a(),de(()=>e=P({get:()=>m.params.nodeId,set:_=>c.isReady().then(()=>c.push({name:"admin.node.index",params:{nodeId:_}}))}))}),(_,s)=>{const E=j,r=ge;return b(),me(ce,null,[u(pe,null,{default:n(()=>[u(_e,{breadcrumb:["\u7BA1\u7406\u9762\u677F","\u8282\u70B9\u7BA1\u7406"]},{title:n(()=>[B("\u8282\u70B9\u5217\u8868")]),action:n(()=>[u(E,{type:"primary","text-color":"white",onClick:s[0]||(s[0]=D=>L(e)?e.value="create":e="create")},{default:n(()=>[B("\u65B0\u5EFA\u8282\u70B9")]),_:1})]),_:1})]),_:1}),u(r,{class:"my-0"}),y("div",Ve,[u(ze,{data:d.value},null,8,["data"]),u(Re,{id:p(e),"onUpdate:id":s[1]||(s[1]=D=>L(e)?e.value=D:e=D),onReload:a},null,8,["id"])])],64)}}});export{Oe as default};
