import{d as B,J as v,h as w,p as m,bB as M,x as S,A as g,m as V,U as T,C as u,z as d,c6 as f,bd as q,B as a,D as C,y as D,ba as y,bc as W,cc as H,_ as J,cd as L,H as U,c1 as j,aq as G,q as K,c7 as O,r as Q,ce as x,W as X,c8 as Y,be as Z,c2 as ee,ca as te}from"./index.1cac1bad.js";import{_ as $}from"./PLink.vue_vue_type_script_setup_true_lang.f43831db.js";import{b as I,c as ae}from"./Time.9bd2104a.js";import{_ as ne}from"./PSelector.vue_vue_type_script_setup_true_lang.72ee34c2.js";import{_ as ue,a as oe}from"./InputNumber.3af073ba.js";import{_ as le}from"./DrawerContent.46b0fda8.js";const se=B({__name:"PAppVersionList",props:["data"],setup(F){const p=[{title:"ID",key:"id",render(n){return w(M,{},()=>n.id)}},{title:"\u540D\u79F0",key:"name"},{title:"\u7248\u672C",key:"version"},{title:"\u955C\u50CF",key:"app",render(n){return w($,{to:{name:"admin.app.index",params:{appId:n.app.id}}},()=>n.app.name)}},{title:"\u5B9E\u4F8B\u6570\u91CF",key:"instances_count"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created_at",render(n){return w(I,{time:new Date(n.created_at)})}},{title:"\u64CD\u4F5C",key:"action",render(n){return w($,{to:{name:"admin.app.version",params:{versionId:n.id}},element:"button",size:"small","text-color":"white"},()=>"\u4FEE\u6539")}}];return(n,b)=>{const _=ae;return m(),v(_,{columns:p,data:F.data,bordered:!0},null,8,["data"])}}}),ie=B({__name:"PAppVersionEditor",props:["id"],emits:["update:id","reload"],setup(F,{emit:p}){const n=F,b=S(),_={id:0,app_id:"",name:"",version:"",created_at:0,updated_at:0},s=g([]),e=g(_),o={init(){e.value=_,o.load()},load(){f.app.list().then(l=>{s.value=l.data.data.map(t=>({label:t.id+"-"+t.name,value:t.id}))}),!i.value&&f.app.version.detail(n.id).then(l=>{e.value=l.data.attributes})},confirm(){i.value?f.app.version.create(e.value).then(()=>{o.close("\u7248\u672C\u521B\u5EFA\u6210\u529F\u3002",!0)}):f.app.version.update(n.id,e.value).then(()=>{o.close("\u7248\u672C\u4FEE\u6539\u6210\u529F\u3002",!0)})},delete(){f.app.version.delete(n.id).then(()=>{o.close("\u7248\u672C\u5220\u9664\u6210\u529F\u3002",!0)})},close(l,t){l&&b.success(l),t&&p("reload"),p("update:id",null)}},k=window.innerWidth,i=V(()=>n.id=="create");return T(()=>n.id,l=>!l||o.init()),(l,t)=>{const N=ue,c=oe,E=J,h=I,R=L,A=U,P=le,z=q;return m(),v(z,{"default-width":Math.min(768,d(k)),resizable:"",placement:"right","mask-closable":!1,show:!!F.id,"onUpdate:show":o.close},{default:u(()=>[a(P,{closable:"","native-scrollbar":!1},{header:u(()=>[C(D(d(i)?"\u521B\u5EFA\u7248\u672C":"\u4FEE\u6539\u7248\u672C"),1)]),footer:u(()=>[d(i)?y("",!0):(m(),v(A,{key:0,type:"error",ghost:"",onClick:t[5]||(t[5]=r=>o.delete())},{default:u(()=>[C("\u5220\u9664")]),_:1})),a(A,{type:"primary","text-color":"white",onClick:t[6]||(t[6]=r=>o.confirm())},{default:u(()=>[C(D(d(i)?"\u521B\u5EFA":"\u4FEE\u6539"),1)]),_:1})]),default:u(()=>[a(R,{model:e.value,"label-placement":"left","label-width":68,class:"mt-2",onSubmit:t[4]||(t[4]=W(r=>o.confirm(),["prevent"]))},{default:u(()=>[d(i)?y("",!0):(m(),v(c,{key:0,label:"ID"},{default:u(()=>[a(N,{value:e.value.id,"onUpdate:value":t[0]||(t[0]=r=>e.value.id=r),readonly:""},null,8,["value"])]),_:1})),a(c,{label:"\u540D\u79F0"},{default:u(()=>[a(E,{value:e.value.name,"onUpdate:value":t[1]||(t[1]=r=>e.value.name=r),placeholder:"\u8F93\u5165\u7248\u672C\u540D\u79F0"},null,8,["value"])]),_:1}),a(c,{label:"\u503C"},{default:u(()=>[a(E,{value:e.value.version,"onUpdate:value":t[2]||(t[2]=r=>e.value.version=r),placeholder:"\u8F93\u5165\u7248\u672C\u503C"},null,8,["value"])]),_:1}),a(c,{label:"\u6240\u5C5E\u955C\u50CF"},{default:u(()=>[a(ne,{modelValue:e.value.app_id,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value.app_id=r),list:s.value},null,8,["modelValue","list"])]),_:1}),d(i)?y("",!0):(m(),v(c,{key:1,label:"\u66F4\u65B0\u65F6\u95F4"},{default:u(()=>[a(h,{time:new Date(e.value.updated_at)},null,8,["time"])]),_:1})),d(i)?y("",!0):(m(),v(c,{key:2,label:"\u521B\u5EFA\u65F6\u95F4",class:"-mt-4"},{default:u(()=>[a(h,{time:new Date(e.value.created_at)},null,8,["time"])]),_:1})),a(H)]),_:1},8,["model"])]),_:1})]),_:1},8,["default-width","show","onUpdate:show"])}}}),re={class:"mdui-container mt-4"},fe=B({__name:"PAppVersion",setup(F){const p=g([]),n=()=>f.app.version.list().then(e=>{p.value=e.data.data}),b=Z(),_=ee();let s;return j().listen(()=>{n(),G(()=>s=V({get:()=>b.params.versionId,set:e=>_.isReady().then(()=>_.push({name:"admin.app.version",params:{versionId:e}}))}))}),(e,o)=>{const k=U,i=te;return m(),K(X,null,[a(O,null,{default:u(()=>[a(Y,{breadcrumb:["\u7BA1\u7406\u9762\u677F","\u955C\u50CF\u7BA1\u7406","\u7248\u672C\u7BA1\u7406"]},{title:u(()=>[C("\u7248\u672C\u5217\u8868")]),action:u(()=>[a(k,{type:"primary","text-color":"white",onClick:o[0]||(o[0]=l=>x(s)?s.value="create":s="create")},{default:u(()=>[C("\u65B0\u5EFA\u7248\u672C")]),_:1})]),_:1})]),_:1}),a(i,{class:"my-0"}),Q("div",re,[a(se,{data:p.value},null,8,["data"]),a(ie,{id:d(s),"onUpdate:id":o[1]||(o[1]=l=>x(s)?s.value=l:s=l),onReload:n},null,8,["id"])])],64)}}});export{fe as default};
